<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Geek Brunch SG</title>
<!-- metacrap -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@geekbrunchsg">
<meta name="twitter:url" property="og:url" content="https://geekbrunch.sg/">
<meta name="twitter:title" property="og:title" content="Geek Brunch SG">
<meta name="twitter:description" property="og:description" content="A biannual social gathering for all engineers, designers and makers in Singapore.">
<meta name="twitter:image" property="og:image" content="https://geekbrunch.sg/background.jpg">
<!-- end metacrap -->
<link rel="icon" href="favicon.png" type="image/png">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Arvo:400">
<style>
html{
  min-height: 100%;
  background-color: #000;
  background-size: cover;
  display: flex;
}
html.nowebgl{
  background: linear-gradient(rgba(0,0,0,.65), rgba(0,0,0,.65)), url(background.jpg) center no-repeat;
}
body{
  font-family: Arvo, sans-serif;
  max-width: 25em;
  padding: 10px;
  margin: auto;
  text-align: center;
  color: #fff;
  line-height: 1.5em;
  text-shadow: 0 1px #000;
}
h1{
  font-weight: normal;
}
a{
  color: #fff;
}
a.button{
  display: inline-block;
  border: 1px solid #fff;
  border-radius: 1em;
  padding: .5em 2em;
  text-decoration: none;
  font-size: 150%;
  background-color: rgba(255,255,255,.2);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
a.button:hover, a.button:active{
  background-color: transparent;
}
footer{
  margin-top: 5em;
  font-size: .8em;
  opacity: .7;
  transition: .3s opacity;
}
footer:hover{
  opacity: 1;
}
#background{
  position: fixed;
  top: 0;
  left: 0;
  opacity: .3;
  pointer-events: none;
  z-index: -1;
  transform-origin: top left;
}
</style>
<h1>Geek Brunch SG</h1>
<p>A biannual social gathering for all developers, makers and designers in&nbsp;Singapore.</p>
<p>Come down and have a brunch. Bring your family &amp; all curious folks&nbsp;along ‚ù§Ô∏è</p>
<div id="event-details">
</div>
<p><a class="button" href="https://www.facebook.com/events/261062764416175/">Join us!</a></p>
<footer>
  Jointly organised by
  <br>
  <a href="https://webuild.sg/">We Build SG</a>, <a href="https://engineers.sg/">Engineers.SG</a> &amp; <a href="https://kopijs.org/">Kopi.JS</a>.
  <br>
  <a href="https://medium.com/we-build-sg/the-story-of-geek-brunch-singapore-943c3c99515f">Read the story</a>.
</footer>
<div id="background">
  <a-scene embedded keyboard-shortcuts="enterVR: false" vr-mode-ui="enabled: false">
    <a-camera wasd-controls-enabled="false"></a-camera>
    <a-sky src="background-360.jpg" rotation="0 80 60">
      <a-animation attribute="rotation" fill="forwards" easing="linear" dur="200000" from="0 200 0" to="0 560 0" repeat="indefinite"></a-animation>
    </a-sky>
  </a-scene>
</div>
<div id="debug"></div>
<script src="https://unpkg.com/date-format-lite@0.9.1/dist/index-min.js"></script>
<script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>
<script>
var $eventDetails = document.getElementById('event-details');
function tzDate(d, offset){ // date object, timezone offset in minutes
  var offsetLocal = d.getTimezoneOffset();
  var diff = (offset - offsetLocal) * 60000;
  return new Date((+d) + diff);
};

// Because Safari doesn't support `fetch`
var xhr = new XMLHttpRequest();
xhr.onload = function(){
  var data = JSON.parse(this.responseText);
  var date = new Date(data.start_time.replace(/(\d{2})(\d{2})$/, '$1:$2'));
  var offsetDate = tzDate(date, -480); // +08:00
  $eventDetails.innerHTML = '<p>üóì '
      + offsetDate.format('DDDD MMM D @ H:mm A')
    + '<br>üó∫ '
      + data.place.name + ', ' + data.place.location.city
    + '</p>';
};
xhr.open('GET', 'https://graph.facebook.com/v2.10/261062764416175?access_token=217930538571201%7C1jrJldK0NmvpP1q4SXtv_5oMcoU');
xhr.send();

var isWebGLSupported = (function(){
  var canvas = document.createElement('canvas');
  var ctx = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
  return ctx !== undefined;
})();

var $bg = document.getElementById('background');
if (!isWebGLSupported){
  document.documentElement.classList.add('nowebgl');
  $bg.innerHTML = '';

  var midPoint = 50, range = 20, prevLeft = 50;
  window.addEventListener('deviceorientation', function(e){
    var side = window.orientation == 0 ? 'gamma' /* portrait */ : 'beta' /* landscape */;
    var rot = Math.max(-range, Math.min(range, e[side]));
    var left = midPoint - midPoint/range*rot;
    var fixedLeft = Math.round(left/2) * 2;
    if (Math.abs(fixedLeft - prevLeft) > 50) return; // Ignore sudden jumps
    prevLeft = fixedLeft;
    // document.getElementById('debug').innerHTML = left + ' ' + prevLeft;
    document.documentElement.style.backgroundPosition = fixedLeft + '% center';
  });
} else {
  var dpr = Math.max(1, window.devicePixelRatio);
  var maxWidth = 800/dpr;
  var fitBg = function(){
    var vw = window.innerWidth;
    if (vw > maxWidth){
      var vh = window.innerHeight;
      var maxHeight = vh / vw * maxWidth;
      var scale = vw / maxWidth;
      $bg.style.width = maxWidth + 'px';
      $bg.style.height = maxHeight + 'px';
      $bg.style.transform = 'scale(' + scale + ')';
    } else {
      $bg.style.width = $bg.style.height = $bg.style.transform = '';
    }
    $bg.querySelector('a-scene').resize(); // Re-render when resize
  };
  window.addEventListener('resize', function(){
    requestAnimationFrame(fitBg);
  }, false);
  fitBg();
}
</script>
